generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Role {
  id              String           @id @default(uuid())
  name            String           @unique
  displayNameEn   String
  displayNameAr   String
  description     String?
  isSystem        Boolean          @default(false)
  isActive        Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  rolePermissions RolePermission[]
  users           User[]

  @@map("roles")
}

model User {
  id                   String              @id @default(uuid())
  email                String              @unique
  password             String
  firstName            String
  lastName             String
  phone                String?
  isActive             Boolean             @default(true)
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  roleId               String
  avatarUrl            String?
  isBookable           Boolean             @default(false)
  appointments         Appointment[]
  auditLogs            AuditLog[]
  uploadedAttachments  MedicalAttachment[] @relation("UploadedAttachments")
  closedMedicalRecords MedicalRecord[]     @relation("ClosedRecords")
  medicalRecords       MedicalRecord[]     @relation("VetRecords")
  slotReservations     SlotReservation[]   @relation("VetReservations")
  sentSmsLogs          SmsLog[]
  permissions          UserPermission[]
  preferences          UserPreferences?
  role                 Role                @relation(fields: [roleId], references: [id])
  vaccinations         Vaccination[]
  vetBreaks            VetBreak[]          @relation("VetBreaks")
  vetDaysOff           VetDayOff[]         @relation("VetDaysOff")
  vetSchedulePeriods   VetSchedulePeriod[] @relation("VetSchedulePeriods")
  vetSchedules         VetSchedule[]       @relation("VetSchedules")
  createdFormTemplates FormTemplate[]      @relation("FormTemplateCreator")
  createdPetForms      PetForm[]           @relation("PetFormCreator")
  boardingAssignedSessions BoardingSession[] @relation("BoardingAssignedVet")
  boardingCreatedSessions  BoardingSession[] @relation("BoardingCreatedBy")

  @@index([roleId])
  @@map("users")
}

model UserPreferences {
  id                String   @id @default(uuid())
  userId            String   @unique
  headerBgColor     String?
  sidebarBgColor    String?
  sidebarHoverColor String?
  flowBoardColors   Json?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_preferences")
}

model Permission {
  id          String           @id @default(uuid())
  name        String           @unique
  description String?
  category    String
  action      String
  createdAt   DateTime         @default(now())
  roles       RolePermission[]
  users       UserPermission[]

  @@map("permissions")
}

model RolePermission {
  id           String     @id @default(uuid())
  permissionId String
  createdAt    DateTime   @default(now())
  roleId       String
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  role         Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
  @@index([roleId])
  @@map("role_permissions")
}

model UserPermission {
  id           String     @id @default(uuid())
  userId       String
  permissionId String
  grantedBy    String?
  grantedAt    DateTime   @default(now())
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, permissionId])
  @@index([userId])
  @@map("user_permissions")
}

model AuditLog {
  id         String   @id @default(uuid())
  userId     String
  action     String
  resource   String
  resourceId String?
  details    Json?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([resource])
  @@index([createdAt])
  @@map("audit_logs")
}

model Owner {
  id               String            @id @default(uuid())
  firstName        String
  lastName         String
  email            String?
  phone            String            @unique
  address          String?
  nationalId       String?
  notes            String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  customerCode     String            @unique
  isVerified       Boolean           @default(false)
  lastLoginAt      DateTime?
  passwordHash     String?
  portalEnabled    Boolean           @default(true)
  preferredLang    String            @default("ar")
  verifiedAt       DateTime?
  invoices         Invoice[]
  otps             OwnerOtp[]
  pets             Pet[]
  reminderLogs     ReminderLog[]
  slotReservations SlotReservation[] @relation("CustomerReservations")
  notifications    CustomerNotification[]

  @@index([customerCode])
  @@index([email])
  @@map("owners")
}

model Pet {
  id             String          @id @default(uuid())
  name           String
  species        Species
  breed          String?
  gender         Gender
  birthDate      DateTime?
  color          String?
  weight         Float?
  microchipId    String?         @unique
  photoUrl       String?
  notes          String?
  isActive       Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  ownerId        String
  petCode        String          @unique
  appointments   Appointment[]
  medicalRecords MedicalRecord[]
  owner          Owner           @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  vaccinations   Vaccination[]
  petForms       PetForm[]
  boardingSessions BoardingSession[]

  @@index([ownerId])
  @@index([petCode])
  @@map("pets")
}

model Appointment {
  id                    String              @id @default(uuid())
  appointmentDate       DateTime
  appointmentTime       String
  duration              Int                 @default(30)
  status                AppointmentStatus   @default(SCHEDULED)
  reason                String?
  notes                 String?
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  petId                 String
  vetId                 String
  visitType             String              @default("GENERAL_CHECKUP")
  isConfirmed           Boolean             @default(false)
  scheduledFromRecordId String?
  cancelledAt           DateTime?
  cancelledBy           CancelledBy?
  source                AppointmentSource   @default(STAFF)
  pet                   Pet                 @relation(fields: [petId], references: [id], onDelete: Cascade)
  scheduledFromRecord   MedicalRecord?      @relation("ScheduledAppointments", fields: [scheduledFromRecordId], references: [id])
  vet                   User                @relation(fields: [vetId], references: [id])
  invoice               Invoice?
  medicalRecords        MedicalRecord?
  reminderLogs          ReminderLog[]
  staffNotifications    StaffNotification[]
  petForms              PetForm[]

  @@index([petId])
  @@index([vetId])
  @@index([appointmentDate])
  @@index([status])
  @@index([scheduledFromRecordId])
  @@index([source])
  @@index([vetId, appointmentDate, appointmentTime, status], map: "idx_appointment_booking_lookup")
  @@map("appointments")
}

model MedicalRecord {
  id                    String              @id @default(uuid())
  visitDate             DateTime            @default(now())
  diagnosis             String?
  symptoms              String?
  treatment             String?
  notes                 String?
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  petId                 String
  vetId                 String
  appointmentId         String?             @unique
  attitude              String?
  behaviour             String?
  bodyConditionScore    Int?
  chiefComplaint        String?
  createdById           String?
  crt                   Float?
  heartRate             Int?
  history               String?
  hydration             String?
  mucousMembranes       String?
  muscleCondition       String?
  painScore             Int?
  respirationRate       Int?
  temperature           Float?
  updatedById           String?
  weight                Float?
  isClosed              Boolean             @default(false)
  closedAt              DateTime?
  closedById            String?
  recordCode            String?             @unique
  version               Int                 @default(1)
  scheduledAppointments Appointment[]       @relation("ScheduledAppointments")
  attachments           MedicalAttachment[]
  appointment           Appointment?        @relation(fields: [appointmentId], references: [id])
  closedBy              User?               @relation("ClosedRecords", fields: [closedById], references: [id])
  pet                   Pet                 @relation(fields: [petId], references: [id], onDelete: Cascade)
  vet                   User                @relation("VetRecords", fields: [vetId], references: [id])
  prescriptions         Prescription[]

  @@index([petId])
  @@index([vetId])
  @@index([visitDate])
  @@index([appointmentId])
  @@index([isClosed])
  @@map("medical_records")
}

model Prescription {
  id              String        @id @default(uuid())
  medication      String
  dosage          String
  frequency       String
  duration        String
  instructions    String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  medicalRecordId String
  medicalRecord   MedicalRecord @relation(fields: [medicalRecordId], references: [id], onDelete: Cascade)

  @@index([medicalRecordId])
  @@map("prescriptions")
}

model Vaccination {
  id          String    @id @default(uuid())
  vaccineName String
  vaccineDate DateTime
  nextDueDate DateTime?
  batchNumber String?
  notes       String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  petId       String
  vetId       String
  pet         Pet       @relation(fields: [petId], references: [id], onDelete: Cascade)
  vet         User      @relation(fields: [vetId], references: [id])

  @@index([petId])
  @@index([vetId])
  @@index([nextDueDate])
  @@map("vaccinations")
}

model Invoice {
  id            String        @id @default(uuid())
  invoiceNumber String        @unique
  issueDate     DateTime      @default(now())
  dueDate       DateTime
  totalAmount   Float         @default(0)
  paidAmount    Float         @default(0)
  status        InvoiceStatus @default(PENDING)
  notes         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  ownerId       String
  appointmentId String?       @unique
  finalizedAt   DateTime?
  isFinalized   Boolean       @default(false)
  items         InvoiceItem[]
  appointment   Appointment?  @relation(fields: [appointmentId], references: [id])
  owner         Owner         @relation(fields: [ownerId], references: [id])
  payments      Payment[]

  @@index([ownerId])
  @@index([invoiceNumber])
  @@index([status])
  @@map("invoices")
}

model InvoiceItem {
  id          String   @id @default(uuid())
  description String
  quantity    Int      @default(1)
  unitPrice   Float
  totalPrice  Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  invoiceId   String
  discount    Float    @default(0)
  invoice     Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@map("invoice_items")
}

model Payment {
  id            String        @id @default(uuid())
  paymentDate   DateTime      @default(now())
  amount        Float
  paymentMethod PaymentMethod @default(CASH)
  notes         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  invoiceId     String
  invoice       Invoice       @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@map("payments")
}

model Category {
  id        String           @id @default(uuid())
  name      String           @unique
  isActive  Boolean          @default(true)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  items     ServiceProduct[]

  @@map("categories")
}

model ServiceProduct {
  id             String   @id @default(uuid())
  name           String
  categoryId     String
  priceBeforeTax Decimal  @db.Decimal(10, 2)
  taxRate        Decimal  @db.Decimal(5, 2)
  priceAfterTax  Decimal  @db.Decimal(10, 2)
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  category       Category @relation(fields: [categoryId], references: [id])

  @@index([categoryId])
  @@index([name])
  @@map("service_products")
}

model MedicalAttachment {
  id              String        @id @default(uuid())
  medicalRecordId String
  fileName        String
  fileUrl         String
  publicId        String?
  fileType        String
  fileSize        Int
  description     String?
  uploadedBy      String
  createdAt       DateTime      @default(now())
  medicalRecord   MedicalRecord @relation(fields: [medicalRecordId], references: [id], onDelete: Cascade)
  uploader        User          @relation("UploadedAttachments", fields: [uploadedBy], references: [id])

  @@index([medicalRecordId])
  @@index([uploadedBy])
  @@map("medical_attachments")
}

model SmsLog {
  id             String    @id @default(uuid())
  messageId      String?
  recipientPhone String
  recipientName  String?
  messageBody    String
  status         SmsStatus @default(PENDING)
  sentAt         DateTime?
  errorMessage   String?
  createdAt      DateTime  @default(now())
  sentById       String?
  sentBy         User?     @relation(fields: [sentById], references: [id])

  @@index([recipientPhone])
  @@index([status])
  @@index([createdAt])
  @@map("sms_logs")
}

model ReminderSetting {
  id              String            @id @default(uuid())
  eventType       ReminderEventType
  isEnabled       Boolean           @default(true)
  sendBeforeHours Int?
  smsEnabled      Boolean           @default(false)
  whatsappEnabled Boolean           @default(false)
  emailEnabled    Boolean           @default(false)
  pushEnabled     Boolean           @default(false)
  templateAr      String?
  templateEn      String?
  reminderOrder   Int               @default(1)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  logs            ReminderLog[]

  @@unique([eventType, reminderOrder])
  @@map("reminder_settings")
}

model ReminderLog {
  id             String              @id @default(uuid())
  settingId      String
  appointmentId  String?
  channel        NotificationChannel
  status         ReminderLogStatus   @default(PENDING)
  recipientPhone String?
  recipientEmail String?
  recipientName  String?
  messageBody    String?
  scheduledFor   DateTime?
  sentAt         DateTime?
  deliveredAt    DateTime?
  errorMessage   String?
  externalId     String?
  createdAt      DateTime            @default(now())
  ownerId        String?
  appointment    Appointment?        @relation(fields: [appointmentId], references: [id])
  owner          Owner?              @relation(fields: [ownerId], references: [id])
  setting        ReminderSetting     @relation(fields: [settingId], references: [id], onDelete: Cascade)

  @@index([settingId])
  @@index([appointmentId])
  @@index([ownerId])
  @@index([status])
  @@index([scheduledFor])
  @@index([createdAt])
  @@map("reminder_logs")
}

model MessageTemplate {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?
  contentAr   String
  contentEn   String
  variables   String[]
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("message_templates")
}

model VetSchedule {
  id           String    @id @default(uuid())
  vetId        String
  dayOfWeek    DayOfWeek
  startTime    String
  endTime      String
  isWorkingDay Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  vet          User      @relation("VetSchedules", fields: [vetId], references: [id], onDelete: Cascade)

  @@unique([vetId, dayOfWeek])
  @@index([vetId])
  @@map("vet_schedules")
}

model VetDayOff {
  id        String   @id @default(uuid())
  vetId     String
  date      DateTime @db.Date
  reason    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  vet       User     @relation("VetDaysOff", fields: [vetId], references: [id], onDelete: Cascade)

  @@unique([vetId, date])
  @@index([vetId])
  @@index([date])
  @@map("vet_days_off")
}

model VetBreak {
  id           String     @id @default(uuid())
  vetId        String
  dayOfWeek    DayOfWeek?
  specificDate DateTime?  @db.Date
  startTime    String
  endTime      String
  description  String?
  isRecurring  Boolean    @default(true)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  vet          User       @relation("VetBreaks", fields: [vetId], references: [id], onDelete: Cascade)

  @@index([vetId])
  @@index([dayOfWeek])
  @@index([specificDate])
  @@map("vet_breaks")
}

model VetSchedulePeriod {
  id             String      @id @default(uuid())
  vetId          String
  startDate      DateTime    @db.Date
  endDate        DateTime    @db.Date
  workingDays    DayOfWeek[]
  workStartTime  String
  workEndTime    String
  breakStartTime String?
  breakEndTime   String?
  isActive       Boolean     @default(true)
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  vet            User        @relation("VetSchedulePeriods", fields: [vetId], references: [id], onDelete: Cascade)

  @@index([vetId])
  @@index([startDate, endDate])
  @@map("vet_schedule_periods")
}

model VisitTypeConfig {
  id        String   @id @default(uuid())
  code      String   @unique
  nameEn    String
  nameAr    String
  duration  Int      @default(30)
  color     String   @default("#3B82F6")
  isActive  Boolean  @default(true)
  isSystem  Boolean  @default(false)
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isActive])
  @@index([sortOrder])
  @@map("visit_type_configs")
}

model OwnerOtp {
  id        String    @id @default(uuid())
  ownerId   String?
  email     String
  code      String
  type      OtpType
  expiresAt DateTime
  usedAt    DateTime?
  attempts  Int       @default(0)
  createdAt DateTime  @default(now())
  owner     Owner?    @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@index([email, type])
  @@index([expiresAt])
  @@map("owner_otps")
}

model StaffNotification {
  id            String      @id @default(uuid())
  type          String
  appointmentId String
  isRead        Boolean     @default(false)
  readAt        DateTime?
  createdAt     DateTime    @default(now())
  status        String?
  actionBy      String?
  actionAt      DateTime?
  rejectReason  String?
  appointment   Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)

  @@index([isRead])
  @@index([createdAt])
  @@index([status])
  @@map("staff_notifications")
}

model SlotReservation {
  id              String            @id @default(uuid())
  vetId           String
  reservationDate DateTime          @db.Date
  reservationTime String
  duration        Int               @default(30)
  customerId      String?
  sessionId       String
  status          ReservationStatus @default(PENDING)
  expiresAt       DateTime
  confirmedAt     DateTime?
  releasedAt      DateTime?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  customer        Owner?            @relation("CustomerReservations", fields: [customerId], references: [id])
  vet             User              @relation("VetReservations", fields: [vetId], references: [id], onDelete: Cascade)

  @@unique([vetId, reservationDate, reservationTime, status], name: "unique_active_reservation", map: "unique_active_reservation")
  @@index([vetId, reservationDate])
  @@index([expiresAt])
  @@index([status])
  @@index([sessionId])
  @@map("slot_reservations")
}

model FormTemplate {
  id                      String       @id @default(uuid())
  nameEn                  String
  nameAr                  String
  contentEn               String
  contentAr               String
  category                FormCategory @default(OTHER)
  requiresClientSignature Boolean      @default(true)
  requiresVetSignature    Boolean      @default(true)
  isActive                Boolean      @default(true)
  headerLogoUrl           String?
  footerText              String?
  createdBy               String
  createdAt               DateTime     @default(now())
  updatedAt               DateTime     @updatedAt

  // Relations
  creator                 User         @relation("FormTemplateCreator", fields: [createdBy], references: [id])
  petForms                PetForm[]

  @@index([category])
  @@index([isActive])
  @@index([createdBy])
  @@map("form_templates")
}

model PetForm {
  id                 String     @id @default(uuid())
  templateId         String
  petId              String
  appointmentId      String?
  filledContentEn    String
  filledContentAr    String
  status             FormStatus @default(DRAFT)
  expiresAt          DateTime?
  notificationSentAt DateTime?
  notificationMethod String?
  createdBy          String
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  completedAt        DateTime?

  // Relations
  template           FormTemplate        @relation(fields: [templateId], references: [id])
  pet                Pet                 @relation(fields: [petId], references: [id], onDelete: Cascade)
  appointment        Appointment?        @relation(fields: [appointmentId], references: [id])
  creator            User                @relation("PetFormCreator", fields: [createdBy], references: [id])
  signatures         FormSignature[]
  notifications      CustomerNotification[]

  @@index([petId])
  @@index([templateId])
  @@index([status])
  @@index([createdBy])
  @@map("pet_forms")
}

model FormSignature {
  id            String     @id @default(uuid())
  petFormId     String
  signerType    SignerType
  signerName    String
  signerId      String?
  signatureData String
  signedAt      DateTime   @default(now())
  ipAddress     String?
  userAgent     String?

  // Relations
  petForm       PetForm    @relation(fields: [petFormId], references: [id], onDelete: Cascade)

  @@unique([petFormId, signerType])
  @@map("form_signatures")
}

model CustomerNotification {
  id            String                   @id @default(uuid())
  ownerId       String
  type          CustomerNotificationType
  titleEn       String
  titleAr       String
  messageEn     String
  messageAr     String
  petFormId     String?
  appointmentId String?
  isRead        Boolean                  @default(false)
  readAt        DateTime?
  emailSent     Boolean                  @default(false)
  emailSentAt   DateTime?
  createdAt     DateTime                 @default(now())

  // Relations
  owner         Owner                    @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  petForm       PetForm?                 @relation(fields: [petFormId], references: [id])

  @@index([ownerId, isRead])
  @@index([type])
  @@map("customer_notifications")
}

enum UserRole {
  ADMIN
  VET
  RECEPTIONIST
}

enum AppointmentStatus {
  SCHEDULED
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  CHECK_IN
  HOSPITALIZED
}

enum VisitType {
  GENERAL_CHECKUP
  GROOMING
  SURGERY
  VACCINATION
  EMERGENCY
}

enum Gender {
  MALE
  FEMALE
}

enum Species {
  DOG
  CAT
  BIRD
  RABBIT
  HAMSTER
  GUINEA_PIG
  TURTLE
  FISH
  OTHER
  HORSE
  GOAT
  SHEEP
  COW
  CAMEL
  DONKEY
  MONKEY
  FERRET
  HEDGEHOG
  SNAKE
  LIZARD
  FROG
  CHICKEN
  DUCK
  PIG
  ALPACA
}

enum InvoiceStatus {
  PENDING
  PAID
  PARTIALLY_PAID
  OVERDUE
}

enum PaymentMethod {
  CASH
  CARD
  BANK_TRANSFER
  MADA
  TABBY
  TAMARA
}

enum SmsStatus {
  PENDING
  SENT
  DELIVERED
  FAILED
}

enum ReminderEventType {
  APPOINTMENT_BOOKED
  APPOINTMENT_CONFIRMED
  APPOINTMENT_CANCELLED
  PRE_APPOINTMENT
  FOLLOW_UP
  OWNER_CREATED
}

enum NotificationChannel {
  SMS
  WHATSAPP
  EMAIL
  PUSH
}

enum ReminderLogStatus {
  PENDING
  SENT
  DELIVERED
  FAILED
  SKIPPED
}

enum OtpType {
  REGISTRATION
  PASSWORD_RESET
}

enum AppointmentSource {
  STAFF
  CUSTOMER_PORTAL
}

enum CancelledBy {
  STAFF
  CUSTOMER
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  EXPIRED
  RELEASED
}

enum DayOfWeek {
  SUNDAY
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
}

enum FormCategory {
  BOARDING
  SURGERY
  VACCINATION
  GROOMING
  CONSENT
  DISCHARGE
  OTHER
}

enum FormStatus {
  DRAFT
  PENDING_CLIENT
  PENDING_VET
  COMPLETED
  EXPIRED
  CANCELLED
}

enum SignerType {
  CLIENT
  VET
  WITNESS
}

enum CustomerNotificationType {
  FORM_PENDING
  FORM_COMPLETED
  APPOINTMENT
  GENERAL
}

// =====================================================
// Record Code Tracker - تتبع أرقام السجلات التسلسلية
// =====================================================

model RecordCodeTracker {
  id          String   @id @default(uuid())
  dateKey     String   @unique // Format: YYYYMMDD
  lastNumber  Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("record_code_tracker")
}

// =====================================================
// Clinic Form Settings - إعدادات النماذج
// =====================================================

model ClinicFormSettings {
  id                     String   @id @default(uuid())
  logoUrl                String?
  logoPosition           String   @default("center") // left, center, right
  clinicNameEn           String   @default("Fluff N' Woof")
  clinicNameAr           String   @default("فلف أند ووف")
  addressEn              String   @default("Riyadh - Kingdom of Saudi Arabia")
  addressAr              String   @default("الرياض - المملكة العربية السعودية")
  phoneNumber            String?
  fontSize               Int      @default(14) // px

  // Signature Settings
  showClientSignature    Boolean  @default(true)
  clientSignatureLabelEn String   @default("Client Signature")
  clientSignatureLabelAr String   @default("توقيع العميل")
  showVetSignature       Boolean  @default(true)
  vetSignatureLabelEn    String   @default("Veterinarian Signature")
  vetSignatureLabelAr    String   @default("توقيع الطبيب البيطري")

  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  @@map("clinic_form_settings")
}

// =====================================================
// Boarding & ICU - إعدادات الإقامة والعناية المركزة
// =====================================================

enum BoardingType {
  BOARDING  // Pet Hotel - فندق الحيوانات
  ICU       // Intensive Care Unit - العناية المركزة
}

enum BoardingSessionStatus {
  ACTIVE      // Currently staying
  COMPLETED   // Checked out
  CANCELLED   // Cancelled
}

model BoardingSlotConfig {
  id            String        @id @default(uuid())
  type          BoardingType  // BOARDING or ICU
  species       Species       // DOG, CAT, etc.
  totalSlots    Int           // Total number of slots available
  pricePerDay   Decimal?      @db.Decimal(10, 2) // Optional daily price
  notes         String?       // Additional notes
  isActive      Boolean       @default(true)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  // Relations
  sessions      BoardingSession[]

  // Constraints - only one config per type+species combination
  @@unique([type, species])
  @@index([type])
  @@index([species])
  @@index([isActive])
  @@map("boarding_slot_configs")
}

model BoardingSession {
  id            String                 @id @default(uuid())
  configId      String
  petId         String
  slotNumber    Int                    // Which slot (1, 2, 3, etc.)
  checkInDate   DateTime
  checkOutDate  DateTime?              // Null if still active
  expectedCheckOutDate DateTime?       // Expected checkout date
  status        BoardingSessionStatus  @default(ACTIVE)
  notes         String?
  dailyRate     Decimal?               @db.Decimal(10, 2) // Rate at time of booking
  totalAmount   Decimal?               @db.Decimal(10, 2) // Calculated on checkout
  assignedVetId String?                // Optional assigned vet for ICU
  createdById   String                 // Who created this session
  createdAt     DateTime               @default(now())
  updatedAt     DateTime               @updatedAt

  // Relations
  config        BoardingSlotConfig     @relation(fields: [configId], references: [id], onDelete: Cascade)
  pet           Pet                    @relation(fields: [petId], references: [id], onDelete: Cascade)
  assignedVet   User?                  @relation("BoardingAssignedVet", fields: [assignedVetId], references: [id])
  createdBy     User                   @relation("BoardingCreatedBy", fields: [createdById], references: [id])

  @@index([configId])
  @@index([petId])
  @@index([status])
  @@index([checkInDate])
  @@index([assignedVetId])
  @@map("boarding_sessions")
}
